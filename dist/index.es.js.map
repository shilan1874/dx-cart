{"version":3,"file":"index.es.js","sources":["../src/index.js"],"sourcesContent":["import NP from 'number-precision'\r\n\r\nfunction setStorage(key, value) {\r\n  localStorage.setItem(key, value)\r\n}\r\n\r\nfunction getStorage(key) {\r\n  return localStorage.getItem(key)\r\n}\r\n\r\n/**\r\n * 设置购物车信息\r\n */\r\nexport function dispatchCartInfo() {\r\n  const count = getStorage('count') || 0\r\n  const cartGoods = JSON.parse(getStorage('cartGoods') || '[]')\r\n  const itemCount = JSON.parse(getStorage('itemCount') || '{}')\r\n  const itemSelected = JSON.parse(getStorage('itemSelected') || '[]')\r\n  return {\r\n    cartInfo: {\r\n      count,\r\n      cartGoods,\r\n      itemCount,\r\n      itemSelected,\r\n      cartList: getCartList()\r\n    },\r\n  }\r\n}\r\n\r\n/**\r\n * 获取购物车商品列表\r\n * 将本地存储cartGoods格式化成购物车所需格式\r\n */\r\nexport const getCartList = () => {\r\n  const data = getStorage('cartGoods')\r\n  const formattedData = formatCartGoods(JSON.parse(data))\r\n  return formattedData\r\n}\r\nfunction formatCartGoods(data) {\r\n  if (data.length === 0) {\r\n    return []\r\n  }\r\n  const formattedData = data.map((item) => {\r\n    const skuData = JSON.parse(item.skuJson)\r\n    const formattedSkuJson = JSON.stringify({\r\n      shopId: item.storeId, // todo 待处理来源\r\n      sku: skuData.skuDTO,\r\n      itemWhole: skuData.itemWholeDTO,\r\n    })\r\n    return {\r\n      id: item.id,\r\n      itemId: item.skuId,\r\n      skuId: item.skuId,\r\n      storeCode: item.storeId,\r\n      storeName: item.storeName,\r\n      skuAmount: item.skuQty,\r\n      skuName: item.skuName,\r\n      skuJson: formattedSkuJson,\r\n      detailPrice: item.skuPrice,\r\n    }\r\n  })\r\n  // 按店铺分组\r\n  const storeCodeList = Array.from(\r\n    new Set(formattedData.map((item) => item.storeCode)),\r\n  )\r\n  const shopItemList = storeCodeList.map((item) => {\r\n    return {\r\n      itemList: [\r\n        {\r\n          activityCommodityList: [],\r\n        },\r\n      ],\r\n      storeCode: item,\r\n      storeName: '',\r\n      storeLogo: '', // todo 需商品详情接口中提供\r\n    }\r\n  })\r\n  formattedData.forEach((item) => {\r\n    const shopItem = shopItemList.find((v) => v.storeCode === item.storeCode)\r\n    if (!shopItem.storeName) {\r\n      shopItem.storeName = item.storeName\r\n    }\r\n    shopItem.itemList[0].activityCommodityList.push(item)\r\n  })\r\n  return {\r\n    cartList: shopItemList,\r\n  }\r\n}\r\n\r\n/**\r\n * 添加至购物车\r\n */\r\nexport function dispatchAddLocalCart(cartItem) {\r\n  const res = getStorage('cartGoods')\r\n  const cartGoods = JSON.parse(res || '[]')\r\n  // 判定是否是重复商品\r\n  let existIndex = -1\r\n  cartGoods.length && cartGoods.forEach((item, index) => {\r\n    if (\r\n      cartItem.storeId === item.storeId &&\r\n      cartItem.itemId === item.itemId &&\r\n      cartItem.skuId === item.skuId\r\n    ) {\r\n      existIndex = index\r\n    }\r\n  })\r\n  if (existIndex === -1) {\r\n    cartGoods.push(cartItem)\r\n  } else {\r\n    cartGoods[existIndex].skuQty += cartItem.skuQty\r\n  }\r\n  setStorage('cartGoods', JSON.stringify(cartGoods))\r\n\r\n  const count = cartGoods.length\r\n  setStorage('count', count)\r\n}\r\n\r\n\r\n/**\r\n * 删除购物车商品\r\n * @ids {array} 数组id\r\n */\r\nexport const deleteCartItem = (ids) => {\r\n  const cartGoods = JSON.parse(getStorage('cartGoods') || '[]')\r\n  const newCartGoods = cartGoods.filter((item) => !ids.includes(item.skuId))\r\n  setStorage('cartGoods', JSON.stringify(newCartGoods))\r\n  dispatchCartInfo()\r\n}\r\n\r\n/**\r\n * 购物车选中状态\r\n * @itemId 当前选择的商品 itemId\r\n */\r\nexport function dispatchCartItemSelect(itemId) {\r\n  let itemSelected\r\n  const oldItem = JSON.parse(getStorage('itemSelected') || '[]')\r\n  if (oldItem.includes(itemId)) {\r\n    itemSelected = oldItem.filter(\r\n      (item) => item !== itemId,\r\n    )\r\n  } else {\r\n    itemSelected = [...oldItem, itemId]\r\n  }\r\n  setStorage('itemSelected', JSON.stringify(itemSelected))\r\n  dispatchCartInfo()\r\n}\r\n\r\n/**\r\n * 获取购物车数量\r\n */\r\nexport function dispatchCartCount() {\r\n  const res = getStorage('cartGoods')\r\n  const count = res ? JSON.parse(res).length : 0\r\n  setStorage('count', count)\r\n}\r\n\r\n/**\r\n * 购物车单个商品数量\r\n */\r\nexport function dispatchCartItemCount({ itemId, count }) {\r\n  const oldCount = JSON.parse(getStorage('itemCount') || '{}')\r\n  const itemCount = {\r\n    ...oldCount,\r\n    [itemId]: count,\r\n  }\r\n  setStorage('itemCount', JSON.stringify(itemCount))\r\n}\r\n\r\n/**\r\n * 同步单个商品数量\r\n */\r\nexport const syncCartItemCount = ({\r\n  itemId,\r\n  changeCount,\r\n}) => {\r\n  const cartGoods = JSON.parse(getStorage('cartGoods') || '[]')\r\n  if (cartGoods.length) {\r\n    const cartItem = cartGoods.find((item) => item.skuId === itemId)\r\n    cartItem.skuQty += changeCount\r\n  }\r\n  setStorage('cartGoods', JSON.stringify(cartGoods))\r\n  dispatchCartInfo()\r\n}\r\n\r\n/**\r\n * 计算购物车选中商品价格\r\n * @saleItems 选择项商品的集合\r\n * @discountsTotalPrice 购物车商品价格\r\n */\r\nexport const getCartPrice = ({ saleItems }) => {\r\n  let data\r\n  if (saleItems.length === 0) {\r\n    data = {}\r\n  } else {\r\n    let discountsTotalPrice = 0\r\n    saleItems.forEach((item) => {\r\n      discountsTotalPrice += NP.times(item.detailPrice, item.skuQty)\r\n    })\r\n    return {\r\n      discountsTotalPrice,\r\n    }\r\n  }\r\n  return data\r\n}\r\n"],"names":[],"mappings":"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"}